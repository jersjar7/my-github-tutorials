<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrix Multiplication - Linear Algebra</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .header h1 {
            font-size: 2.8em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
            color: #FFD700;
        }
        
        .header .breadcrumb {
            font-size: 1em;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        
        .header .description {
            font-size: 1.2em;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .section h2 {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #FFD700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-icon {
            font-size: 1.2em;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .matrix-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .matrix {
            position: relative;
            display: inline-block;
            padding: 15px 5px;
        }
        
        .matrix::before,
        .matrix::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 8px;
            border: 3px solid #333;
        }
        
        .matrix::before {
            left: 0;
            border-right: none;
        }
        
        .matrix::after {
            right: 0;
            border-left: none;
        }
        
        .matrix-grid {
            display: grid;
            gap: 5px;
            padding: 0 10px;
        }
        
        .matrix-cell {
            width: 60px;
            height: 40px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
            font-size: 16px;
            background: white;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .matrix-cell input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            font-size: 14px;
            background: transparent;
            color: #333;
        }
        
        .matrix-cell input:focus {
            outline: 2px solid #4CAF50;
            background: #f0f8ff;
        }
        
        .matrix-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: bold;
            color: #333;
            font-size: 18px;
        }
        
        .dimension-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #666;
        }
        
        .operation-symbol {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
        }
        
        .equals-symbol {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .result-matrix {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4CAF50;
            border-radius: 10px;
            padding: 10px;
        }
        
        .result-matrix .matrix-cell {
            background: rgba(76, 175, 80, 0.1);
            border-color: #4CAF50;
            color: #2e7d32;
            font-weight: bold;
        }
        
        .highlighted-row {
            background: rgba(255, 193, 7, 0.7) !important;
            border-color: #FFC107 !important;
            color: #333 !important;
        }
        
        .highlighted-col {
            background: rgba(33, 150, 243, 0.7) !important;
            border-color: #2196F3 !important;
            color: #333 !important;
        }
        
        .highlighted-result {
            background: rgba(76, 175, 80, 0.8) !important;
            border-color: #4CAF50 !important;
            color: #fff !important;
            transform: scale(1.1);
        }
        
        .matrix-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .size-control {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .size-control select {
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background: white;
            color: #333;
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-size: 14px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #FF9800, #f57c00);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .concept-explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #FFD700;
            margin-bottom: 20px;
        }
        
        .concept-explanation h4 {
            color: #FFD700;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .concept-explanation p {
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .formula {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            text-align: center;
            margin: 10px 0;
            font-size: 1.1em;
        }
        
        .step-display {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            min-height: 100px;
        }
        
        .step-display h4 {
            color: #2196F3;
            margin-bottom: 10px;
        }
        
        .step-calculation {
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            margin: 10px 0;
            padding: 10px;
            background: rgba(33, 150, 243, 0.1);
            border-radius: 5px;
        }
        
        .dimension-checker {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .dimension-valid {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .dimension-invalid {
            color: #f44336;
            font-weight: bold;
        }
        
        .practice-section {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .practice-section h3 {
            color: #FFD700;
            margin-bottom: 15px;
        }
        
        .exercise {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .exercise-question {
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .exercise-matrices {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .exercise-input-matrix {
            display: grid;
            gap: 3px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
        }
        
        .exercise-input-matrix input {
            width: 40px;
            height: 30px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 12px;
        }
        
        .ml-application {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .ml-application h4 {
            color: #4CAF50;
            margin-bottom: 10px;
        }
        
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .matrix-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .matrix-cell {
                width: 50px;
                height: 35px;
            }
            
            .operation-symbol,
            .equals-symbol {
                font-size: 1.5em;
            }
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .matrix-cell {
                width: 45px;
                height: 30px;
                font-size: 12px;
            }
            
            .matrix-controls {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="breadcrumb">🤖 ML Preparation › 📊 Linear Algebra › ⚡ Matrix Multiplication</div>
            <h1>Matrix Multiplication</h1>
            <p class="description">
                The powerhouse operation of machine learning! Matrix multiplication transforms data, computes neural network activations, performs linear regression, and drives virtually every ML algorithm. Master this and you'll understand the engine behind modern AI.
            </p>
        </div>
        
        <div class="content-grid">
            <div class="section">
                <h2><span class="section-icon">⚡</span>Interactive Multiplication</h2>
                
                <div class="matrix-controls">
                    <div class="size-control">
                        <label>A size:</label>
                        <select id="matrixASize" onchange="updateMatrixSizes()">
                            <option value="2x2">2×2</option>
                            <option value="2x3" selected>2×3</option>
                            <option value="3x2">3×2</option>
                            <option value="3x3">3×3</option>
                        </select>
                    </div>
                    <div class="size-control">
                        <label>B size:</label>
                        <select id="matrixBSize" onchange="updateMatrixSizes()">
                            <option value="2x2">2×2</option>
                            <option value="3x2" selected>3×2</option>
                            <option value="2x3">2×3</option>
                            <option value="3x3">3×3</option>
                        </select>
                    </div>
                </div>
                
                <div class="dimension-checker" id="dimensionChecker">
                    <div class="dimension-valid">✓ Valid: (2×3) × (3×2) = (2×2)</div>
                </div>
                
                <div class="matrix-container" id="multiplicationContainer">
                    <!-- Matrices will be generated here -->
                </div>
                
                <div class="matrix-controls">
                    <button class="btn" onclick="calculateMultiplication()">Calculate A×B</button>
                    <button class="btn btn-secondary" onclick="animateMultiplication()">Step-by-Step</button>
                    <button class="btn btn-warning" onclick="randomizeMatrices()">Randomize</button>
                    <button class="btn btn-danger" onclick="clearResults()">Clear</button>
                </div>
                
                <div class="step-display" id="stepDisplay">
                    <h4>How Matrix Multiplication Works</h4>
                    <p>Click "Step-by-Step" to see the row × column dot product process!</p>
                    <p><strong>Key Rule:</strong> Element (i,j) of result = Row i of A · Column j of B</p>
                </div>
            </div>
            
            <div class="section">
                <h2><span class="section-icon">📐</span>Dimension Rules</h2>
                
                <div class="concept-explanation">
                    <h4>The Golden Rule</h4>
                    <p>For A × B to be valid:</p>
                    <div class="formula">(m×n) × (n×p) = (m×p)</div>
                    <p>Inner dimensions must match! Outer dimensions give result size.</p>
                </div>
                
                <div class="concept-explanation">
                    <h4>Non-Commutative Property</h4>
                    <p>Matrix multiplication is NOT commutative:</p>
                    <div class="formula">A × B ≠ B × A</div>
                    <p>Order matters! This is different from regular number multiplication.</p>
                </div>
                
                <div class="matrix-controls">
                    <button class="btn" onclick="demonstrateNonCommutative()">Show A×B ≠ B×A</button>
                    <button class="btn btn-secondary" onclick="showDimensionExamples()">Dimension Examples</button>
                </div>
                
                <div id="nonCommutativeDemo" style="display: none;">
                    <div class="concept-explanation">
                        <h4>Non-Commutative Demonstration</h4>
                        <p id="commutativeResults"></p>
                    </div>
                </div>
                
                <div class="ml-application">
                    <h4>🤖 ML Application: Neural Networks</h4>
                    <p>In neural networks, we compute: <strong>Input × Weights = Output</strong></p>
                    <p>If input is (1×784) and weights are (784×128), output is (1×128)</p>
                    <p>This transforms 784 pixels into 128 features!</p>
                </div>
            </div>
        </div>
        
        <div class="content-grid">
            <div class="section">
                <h2><span class="section-icon">🔍</span>Step-by-Step Process</h2>
                
                <div class="concept-explanation">
                    <h4>The Algorithm</h4>
                    <p>To find element (i,j) in the result:</p>
                    <p>1. Take row i from matrix A</p>
                    <p>2. Take column j from matrix B</p>
                    <p>3. Compute their dot product</p>
                    <p>4. Place result at position (i,j)</p>
                </div>
                
                <div class="step-calculation" id="currentCalculation">
                    Click "Step-by-Step" to see live calculations here!
                </div>
                
                <div class="concept-explanation">
                    <h4>Example: Element (1,1)</h4>
                    <p>Row 1 of A: [a₁₁, a₁₂, a₁₃]</p>
                    <p>Column 1 of B: [b₁₁, b₂₁, b₃₁]ᵀ</p>
                    <p>Result₁₁ = a₁₁×b₁₁ + a₁₂×b₂₁ + a₁₃×b₃₁</p>
                </div>
            </div>
            
            <div class="section">
                <h2><span class="section-icon">🎯</span>Common Patterns</h2>
                
                <div class="concept-explanation">
                    <h4>Identity Multiplication</h4>
                    <p>Any matrix times the identity equals itself:</p>
                    <div class="formula">A × I = I × A = A</div>
                </div>
                
                <div class="concept-explanation">
                    <h4>Vector-Matrix Patterns</h4>
                    <p><strong>Row vector × Matrix:</strong> (1×n) × (n×m) = (1×m)</p>
                    <p><strong>Matrix × Column vector:</strong> (m×n) × (n×1) = (m×1)</p>
                    <p>These are the most common patterns in ML!</p>
                </div>
                
                <div class="matrix-controls">
                    <button class="btn" onclick="showVectorPatterns()">Vector Examples</button>
                    <button class="btn btn-secondary" onclick="showIdentityExample()">Identity Example</button>
                </div>
                
                <div class="ml-application">
                    <h4>🤖 ML Application: Linear Regression</h4>
                    <p>Linear regression uses: <strong>y = X × w + b</strong></p>
                    <p>Where X is data (m×n), w is weights (n×1), result is predictions (m×1)</p>
                </div>
            </div>
        </div>
        
        <div class="section full-width">
            <h2><span class="section-icon">🎯</span>Practice Exercises</h2>
            <div class="practice-section">
                <h3>Master Matrix Multiplication</h3>
                
                <div class="exercise">
                    <div class="exercise-question">1. Calculate the (1,1) element of A×B where A = [1, 2; 3, 4] and B = [2, 0; 1, 3]</div>
                    <div class="exercise-matrices">
                        <span>Element (1,1) = </span>
                        <input type="number" id="ex1_result" placeholder="?" style="width: 60px; text-align: center;">
                        <button class="btn" onclick="checkExercise1()">Check</button>
                        <span id="ex1_feedback"></span>
                    </div>
                </div>
                
                <div class="exercise">
                    <div class="exercise-question">2. What are the dimensions of the result when multiplying (3×4) × (4×2)?</div>
                    <div class="exercise-matrices">
                        <span>Result dimensions: </span>
                        <input type="number" id="ex2_rows" placeholder="rows" style="width: 50px; text-align: center;">
                        <span>×</span>
                        <input type="number" id="ex2_cols" placeholder="cols" style="width: 50px; text-align: center;">
                        <button class="btn" onclick="checkExercise2()">Check</button>
                        <span id="ex2_feedback"></span>
                    </div>
                </div>
                
                <div class="exercise">
                    <div class="exercise-question">3. Can you multiply (2×3) × (2×3)? Why or why not?</div>
                    <div class="exercise-matrices">
                        <button class="btn" onclick="checkExercise3(true)">Yes</button>
                        <button class="btn btn-secondary" onclick="checkExercise3(false)">No</button>
                        <span id="ex3_feedback"></span>
                    </div>
                </div>
                
                <div class="exercise">
                    <div class="exercise-question">4. Complete: [2, 1] × [3; 4] = ?</div>
                    <div class="exercise-matrices">
                        <span>Result = </span>
                        <input type="number" id="ex4_result" placeholder="?" style="width: 60px; text-align: center;">
                        <button class="btn" onclick="checkExercise4()">Check</button>
                        <span id="ex4_feedback"></span>
                    </div>
                    <p style="font-size: 0.9em; opacity: 0.8; margin-top: 10px;">
                        Hint: This is a (1×2) × (2×1) multiplication
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Matrix data storage
        let currentMatrices = {
            A: [[1, 2, 0], [3, 1, 4]],
            B: [[2, 1], [0, 3], [1, 2]],
            result: [[0, 0], [0, 0]]
        };
        
        let animationState = {
            isAnimating: false,
            currentRow: 0,
            currentCol: 0,
            step: 0
        };
        
        function parseDimensions(sizeStr) {
            const [rows, cols] = sizeStr.split('x').map(Number);
            return { rows, cols };
        }
        
        function createMatrix(rows, cols, id, label, values = null, isResult = false, isEditable = true) {
            const matrix = document.createElement('div');
            matrix.className = 'matrix' + (isResult ? ' result-matrix' : '');
            
            const labelDiv = document.createElement('div');
            labelDiv.className = 'matrix-label';
            labelDiv.textContent = label;
            matrix.appendChild(labelDiv);
            
            const dimensionDiv = document.createElement('div');
            dimensionDiv.className = 'dimension-label';
            dimensionDiv.textContent = `${rows}×${cols}`;
            matrix.appendChild(dimensionDiv);
            
            const grid = document.createElement('div');
            grid.className = 'matrix-grid';
            grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            grid.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
            
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'matrix-cell';
                    
                    if (isEditable && !isResult) {
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.step = '0.1';
                        input.value = values ? values[i][j] : (Math.floor(Math.random() * 5) + 1);
                        input.id = `${id}_${i}_${j}`;
                        input.addEventListener('input', () => updateMatrixData(id, i, j, parseFloat(input.value) || 0));
                        cell.appendChild(input);
                    } else {
                        cell.textContent = values ? values[i][j] : '';
                        cell.id = `${id}_${i}_${j}`;
                    }
                    
                    grid.appendChild(cell);
                }
            }
            
            matrix.appendChild(grid);
            return matrix;
        }
        
        function updateMatrixData(matrixId, row, col, value) {
            if (matrixId.includes('A')) {
                currentMatrices.A[row][col] = value;
            } else if (matrixId.includes('B')) {
                currentMatrices.B[row][col] = value;
            }
        }
        
        function updateMatrixSizes() {
            const aSizeStr = document.getElementById('matrixASize').value;
            const bSizeStr = document.getElementById('matrixBSize').value;
            
            const aDim = parseDimensions(aSizeStr);
            const bDim = parseDimensions(bSizeStr);
            
            // Check dimension compatibility
            const isValid = aDim.cols === bDim.rows;
            const checker = document.getElementById('dimensionChecker');
            
            if (isValid) {
                checker.innerHTML = `<div class="dimension-valid">✓ Valid: (${aDim.rows}×${aDim.cols}) × (${bDim.rows}×${bDim.cols}) = (${aDim.rows}×${bDim.cols})</div>`;
                checker.className = 'dimension-checker';
            } else {
                checker.innerHTML = `<div class="dimension-invalid">✗ Invalid: (${aDim.rows}×${aDim.cols}) × (${bDim.rows}×${bDim.cols}) - Inner dimensions don't match!</div>`;
                checker.className = 'dimension-checker';
            }
            
            // Initialize matrices with new dimensions
            currentMatrices.A = Array(aDim.rows).fill().map(() => 
                Array(aDim.cols).fill().map(() => Math.floor(Math.random() * 5) + 1)
            );
            currentMatrices.B = Array(bDim.rows).fill().map(() => 
                Array(bDim.cols).fill().map(() => Math.floor(Math.random() * 5) + 1)
            );
            
            if (isValid) {
                currentMatrices.result = Array(aDim.rows).fill().map(() => Array(bDim.cols).fill(0));
            }
            
            updateMatrixDisplay();
        }
        
        function updateMatrixDisplay() {
            const aSizeStr = document.getElementById('matrixASize').value;
            const bSizeStr = document.getElementById('matrixBSize').value;
            
            const aDim = parseDimensions(aSizeStr);
            const bDim = parseDimensions(bSizeStr);
            const isValid = aDim.cols === bDim.rows;
            
            const container = document.getElementById('multiplicationContainer');
            container.innerHTML = '';
            
            const matrixA = createMatrix(aDim.rows, aDim.cols, 'mult_A', 'A', currentMatrices.A);
            const timesSymbol = document.createElement('div');
            timesSymbol.className = 'operation-symbol';
            timesSymbol.textContent = '×';
            
            const matrixB = createMatrix(bDim.rows, bDim.cols, 'mult_B', 'B', currentMatrices.B);
            const equalsSymbol = document.createElement('div');
            equalsSymbol.className = 'equals-symbol';
            equalsSymbol.textContent = '=';
            
            container.appendChild(matrixA);
            container.appendChild(timesSymbol);
            container.appendChild(matrixB);
            container.appendChild(equalsSymbol);
            
            if (isValid) {
                const resultMatrix = createMatrix(aDim.rows, bDim.cols, 'mult_result', 'A×B', currentMatrices.result, true, false);
                container.appendChild(resultMatrix);
            } else {
                const errorDiv = document.createElement('div');
                errorDiv.style.color = '#f44336';
                errorDiv.style.fontSize = '1.2em';
                errorDiv.style.fontWeight = 'bold';
                errorDiv.textContent = 'Cannot multiply!';
                container.appendChild(errorDiv);
            }
        }
        
        function calculateMultiplication() {
            const aSizeStr = document.getElementById('matrixASize').value;
            const bSizeStr = document.getElementById('matrixBSize').value;
            
            const aDim = parseDimensions(aSizeStr);
            const bDim = parseDimensions(bSizeStr);
            
            if (aDim.cols !== bDim.rows) {
                alert('Cannot multiply matrices with incompatible dimensions!');
                return;
            }
            
            // Get current matrix values from inputs
            for (let i = 0; i < aDim.rows; i++) {
                for (let j = 0; j < aDim.cols; j++) {
                    const input = document.getElementById(`mult_A_${i}_${j}`);
                    currentMatrices.A[i][j] = parseFloat(input.value) || 0;
                }
            }
            
            for (let i = 0; i < bDim.rows; i++) {
                for (let j = 0; j < bDim.cols; j++) {
                    const input = document.getElementById(`mult_B_${i}_${j}`);
                    currentMatrices.B[i][j] = parseFloat(input.value) || 0;
                }
            }
            
            // Perform multiplication
            for (let i = 0; i < aDim.rows; i++) {
                for (let j = 0; j < bDim.cols; j++) {
                    let sum = 0;
                    for (let k = 0; k < aDim.cols; k++) {
                        sum += currentMatrices.A[i][k] * currentMatrices.B[k][j];
                    }
                    currentMatrices.result[i][j] = sum;
                    document.getElementById(`mult_result_${i}_${j}`).textContent = sum;
                }
            }
            
            document.getElementById('stepDisplay').innerHTML = `
                <h4>Multiplication Complete!</h4>
                <p>All elements calculated using row × column dot products.</p>
                <p><strong>Result:</strong> (${aDim.rows}×${aDim.cols}) × (${bDim.rows}×${bDim.cols}) = (${aDim.rows}×${bDim.cols})</p>
            `;
        }
        
        function animateMultiplication() {
            if (animationState.isAnimating) return;
            
            const aSizeStr = document.getElementById('matrixASize').value;
            const bSizeStr = document.getElementById('matrixBSize').value;
            
            const aDim = parseDimensions(aSizeStr);
            const bDim = parseDimensions(bSizeStr);
            
            if (aDim.cols !== bDim.rows) {
                alert('Cannot multiply matrices with incompatible dimensions!');
                return;
            }
            
            clearHighlights();
            animationState.isAnimating = true;
            animationState.currentRow = 0;
            animationState.currentCol = 0;
            
            animateNextElement(aDim, bDim);
        }
        
        function animateNextElement(aDim, bDim) {
            const i = animationState.currentRow;
            const j = animationState.currentCol;
            
            if (i >= aDim.rows) {
                animationState.isAnimating = false;
                clearHighlights();
                document.getElementById('stepDisplay').innerHTML = `
                    <h4>Animation Complete!</h4>
                    <p>All ${aDim.rows}×${bDim.cols} elements calculated step by step.</p>
                `;
                return;
            }
            
            clearHighlights();
            
            // Highlight current row in A
            for (let k = 0; k < aDim.cols; k++) {
                document.getElementById(`mult_A_${i}_${k}`).classList.add('highlighted-row');
            }
            
            // Highlight current column in B
            for (let k = 0; k < bDim.rows; k++) {
                document.getElementById(`mult_B_${k}_${j}`).classList.add('highlighted-col');
            }
            
            // Calculate dot product
            let sum = 0;
            let calculation = `Element (${i+1},${j+1}) = `;
            let terms = [];
            
            for (let k = 0; k < aDim.cols; k++) {
                const aVal = currentMatrices.A[i][k];
                const bVal = currentMatrices.B[k][j];
                sum += aVal * bVal;
                terms.push(`${aVal}×${bVal}`);
            }
            
            calculation += terms.join(' + ') + ` = ${sum}`;
            
            document.getElementById('stepDisplay').innerHTML = `
                <h4>Calculating Element (${i+1},${j+1})</h4>
                <p>Row ${i+1} of A × Column ${j+1} of B</p>
                <div class="step-calculation">${calculation}</div>
            `;
            
            document.getElementById('currentCalculation').textContent = calculation;
            
            // Update result
            currentMatrices.result[i][j] = sum;
            const resultCell = document.getElementById(`mult_result_${i}_${j}`);
            resultCell.textContent = sum;
            resultCell.classList.add('highlighted-result');
            
            // Move to next element
            setTimeout(() => {
                animationState.currentCol++;
                if (animationState.currentCol >= bDim.cols) {
                    animationState.currentCol = 0;
                    animationState.currentRow++;
                }
                animateNextElement(aDim, bDim);
            }, 2000);
        }
        
        function clearHighlights() {
            document.querySelectorAll('.highlighted-row, .highlighted-col, .highlighted-result').forEach(cell => {
                cell.classList.remove('highlighted-row', 'highlighted-col', 'highlighted-result');
            });
        }
        
        function randomizeMatrices() {
            const aSizeStr = document.getElementById('matrixASize').value;
            const bSizeStr = document.getElementById('matrixBSize').value;
            
            const aDim = parseDimensions(aSizeStr);
            const bDim = parseDimensions(bSizeStr);
            
            // Randomize A
            for (let i = 0; i < aDim.rows; i++) {
                for (let j = 0; j < aDim.cols; j++) {
                    const newValue = Math.floor(Math.random() * 5) + 1;
                    currentMatrices.A[i][j] = newValue;
                    document.getElementById(`mult_A_${i}_${j}`).value = newValue;
                }
            }
            
            // Randomize B
            for (let i = 0; i < bDim.rows; i++) {
                for (let j = 0; j < bDim.cols; j++) {
                    const newValue = Math.floor(Math.random() * 5) + 1;
                    currentMatrices.B[i][j] = newValue;
                    document.getElementById(`mult_B_${i}_${j}`).value = newValue;
                }
            }
        }
        
        function clearResults() {
            const aSizeStr = document.getElementById('matrixASize').value;
            const bSizeStr = document.getElementById('matrixBSize').value;
            
            const aDim = parseDimensions(aSizeStr);
            const bDim = parseDimensions(bSizeStr);
            
            if (aDim.cols === bDim.rows) {
                for (let i = 0; i < aDim.rows; i++) {
                    for (let j = 0; j < bDim.cols; j++) {
                        currentMatrices.result[i][j] = 0;
                        document.getElementById(`mult_result_${i}_${j}`).textContent = '';
                    }
                }
            }
            
            clearHighlights();
            
            document.getElementById('stepDisplay').innerHTML = `
                <h4>Results Cleared</h4>
                <p>Ready for new calculation. Use "Calculate A×B" or "Step-by-Step".</p>
            `;
        }
        
        function demonstrateNonCommutative() {
            // Use 2x2 matrices for simplicity
            const A = [[1, 2], [3, 4]];
            const B = [[2, 0], [1, 3]];
            
            // Calculate A×B
            const AB = [[0, 0], [0, 0]];
            for (let i = 0; i < 2; i++) {
                for (let j = 0; j < 2; j++) {
                    AB[i][j] = A[i][0] * B[0][j] + A[i][1] * B[1][j];
                }
            }
            
            // Calculate B×A
            const BA = [[0, 0], [0, 0]];
            for (let i = 0; i < 2; i++) {
                for (let j = 0; j < 2; j++) {
                    BA[i][j] = B[i][0] * A[0][j] + B[i][1] * A[1][j];
                }
            }
            
            document.getElementById('commutativeResults').innerHTML = `
                <strong>A×B = [${AB[0][0]}, ${AB[0][1]}; ${AB[1][0]}, ${AB[1][1]}]</strong><br>
                <strong>B×A = [${BA[0][0]}, ${BA[0][1]}; ${BA[1][0]}, ${BA[1][1]}]</strong><br>
                See? They're different! A×B ≠ B×A
            `;
            
            document.getElementById('nonCommutativeDemo').style.display = 'block';
        }
        
        function showDimensionExamples() {
            alert(`Dimension Examples:
            
✓ (2×3) × (3×4) = (2×4) - Valid
✓ (5×2) × (2×1) = (5×1) - Valid  
✓ (1×100) × (100×50) = (1×50) - Valid (common in ML!)

✗ (2×3) × (2×4) = Invalid (3 ≠ 2)
✗ (4×5) × (3×2) = Invalid (5 ≠ 3)

Remember: Inner dimensions must match!`);
        }
        
        function showVectorPatterns() {
            alert(`Common ML Patterns:

🔹 Row vector × Matrix:
   (1×n) × (n×m) = (1×m)
   Example: (1×784) × (784×10) = (1×10)
   
🔹 Matrix × Column vector:
   (m×n) × (n×1) = (m×1)
   Example: (100×5) × (5×1) = (100×1)
   
🔹 Data × Weights:
   (batch_size×features) × (features×outputs)
   This is the foundation of neural networks!`);
        }
        
        function showIdentityExample() {
            alert(`Identity Matrix Example:

I = [1, 0; 0, 1]  (2×2 identity)
A = [3, 4; 1, 2]  (any 2×2 matrix)

A × I = [3, 4; 1, 2] = A
I × A = [3, 4; 1, 2] = A

The identity matrix is like multiplying by 1!`);
        }
        
        // Exercise checking functions
        function checkExercise1() {
            const userAnswer = parseFloat(document.getElementById('ex1_result').value);
            const correct = 1*2 + 2*1; // Row 1 of A × Column 1 of B = 4
            
            if (userAnswer === correct) {
                document.getElementById('ex1_feedback').innerHTML = ' <span style="color: #4CAF50;">✓ Correct! (1×2 + 2×1 = 4)</span>';
            } else {
                document.getElementById('ex1_feedback').innerHTML = ' <span style="color: #f44336;">✗ Try again (Row 1 × Column 1)</span>';
            }
        }
        
        function checkExercise2() {
            const userRows = parseInt(document.getElementById('ex2_rows').value);
            const userCols = parseInt(document.getElementById('ex2_cols').value);
            
            if (userRows === 3 && userCols === 2) {
                document.getElementById('ex2_feedback').innerHTML = ' <span style="color: #4CAF50;">✓ Correct! (3×4) × (4×2) = (3×2)</span>';
            } else {
                document.getElementById('ex2_feedback').innerHTML = ' <span style="color: #f44336;">✗ Try again (outer dimensions)</span>';
            }
        }
        
        function checkExercise3(userAnswer) {
            const correct = false; // Cannot multiply (2×3) × (2×3) because 3 ≠ 2
            
            if (userAnswer === correct) {
                document.getElementById('ex3_feedback').innerHTML = ' <span style="color: #4CAF50;">✓ Correct! Inner dimensions (3 and 2) don\'t match.</span>';
            } else {
                document.getElementById('ex3_feedback').innerHTML = ' <span style="color: #f44336;">✗ Wrong. Check inner dimensions: 3 ≠ 2</span>';
            }
        }
        
        function checkExercise4() {
            const userAnswer = parseFloat(document.getElementById('ex4_result').value);
            const correct = 2*3 + 1*4; // [2,1] × [3;4] = 2×3 + 1×4 = 10
            
            if (userAnswer === correct) {
                document.getElementById('ex4_feedback').innerHTML = ' <span style="color: #4CAF50;">✓ Correct! (2×3 + 1×4 = 10)</span>';
            } else {
                document.getElementById('ex4_feedback').innerHTML = ' <span style="color: #f44336;">✗ Try again (2×3 + 1×4 = ?)</span>';
            }
        }
        
        // Initialize everything
        window.addEventListener('load', function() {
            updateMatrixSizes();
        });
    </script>
</body>
</html>
