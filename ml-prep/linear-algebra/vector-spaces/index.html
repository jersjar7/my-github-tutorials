<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vector Spaces & Independence - Linear Algebra</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .header h1 {
            font-size: 2.8em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
            color: #FFD700;
        }
        
        .header .breadcrumb {
            font-size: 1em;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        
        .header .description {
            font-size: 1.2em;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .section h2 {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #FFD700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-icon {
            font-size: 1.2em;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .canvas-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            color: #333;
        }
        
        .canvas-container h3 {
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }
        
        canvas {
            border: 2px solid #333;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
            background: white;
            cursor: crosshair;
        }
        
        .vector-input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .vector-input {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .vector-input h4 {
            color: #FFD700;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .vector-components {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }
        
        .vector-components input {
            width: 60px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            text-align: center;
            font-size: 14px;
        }
        
        .vector-components label {
            font-weight: 500;
            margin: 0 5px;
        }
        
        .independence-result {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .independent {
            border: 3px solid #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .dependent {
            border: 3px solid #f44336;
            background: rgba(244, 67, 54, 0.1);
        }
        
        .independence-result h4 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .independence-explanation {
            font-size: 1em;
            line-height: 1.5;
            margin-top: 10px;
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-size: 14px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #FF9800, #f57c00);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }
        
        .btn-purple {
            background: linear-gradient(45deg, #9C27B0, #7B1FA2);
        }
        
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .concept-explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #FFD700;
            margin-bottom: 20px;
        }
        
        .concept-explanation h4 {
            color: #FFD700;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .concept-explanation p {
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .formula {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            text-align: center;
            margin: 10px 0;
            font-size: 1.1em;
        }
        
        .span-visualization {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .span-visualization h4 {
            color: #2196F3;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .basis-builder {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .basis-builder h4 {
            color: #9C27B0;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .basis-test-result {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .valid-basis {
            border: 2px solid #4CAF50;
            color: #4CAF50;
        }
        
        .invalid-basis {
            border: 2px solid #f44336;
            color: #f44336;
        }
        
        .three-container {
            width: 100%;
            height: 400px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .dimension-display {
            background: rgba(33, 150, 243, 0.2);
            border: 2px solid #2196F3;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .ml-application {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .ml-application h4 {
            color: #4CAF50;
            margin-bottom: 10px;
        }
        
        .practice-section {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .practice-section h3 {
            color: #FFD700;
            margin-bottom: 15px;
        }
        
        .exercise {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .exercise-question {
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .exercise-input {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .vector-display {
            font-family: 'Courier New', monospace;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }
        
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .vector-input-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .vector-components {
                flex-direction: column;
                gap: 5px;
            }
            
            .controls {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="breadcrumb">🤖 ML Preparation › 📊 Linear Algebra › 🌐 Vector Spaces & Independence</div>
            <h1>Vector Spaces & Independence</h1>
            <p class="description">
                Discover the hidden structure of data! Vector spaces and linear independence reveal when information is truly independent vs. redundant. Master these concepts to understand dimensionality reduction, feature selection, and why some ML problems have unique solutions while others don't.
            </p>
        </div>
        
        <div class="content-grid">
            <div class="section">
                <h2><span class="section-icon">🔍</span>Linear Independence Checker</h2>
                
                <div class="vector-input-grid">
                    <div class="vector-input">
                        <h4>Vector 1</h4>
                        <div class="vector-components">
                            <label>x:</label>
                            <input type="number" id="v1_x" value="2" step="0.1">
                            <label>y:</label>
                            <input type="number" id="v1_y" value="1" step="0.1">
                        </div>
                    </div>
                    
                    <div class="vector-input">
                        <h4>Vector 2</h4>
                        <div class="vector-components">
                            <label>x:</label>
                            <input type="number" id="v2_x" value="1" step="0.1">
                            <label>y:</label>
                            <input type="number" id="v2_y" value="3" step="0.1">
                        </div>
                    </div>
                    
                    <div class="vector-input">
                        <h4>Vector 3 (Optional)</h4>
                        <div class="vector-components">
                            <label>x:</label>
                            <input type="number" id="v3_x" value="0" step="0.1">
                            <label>y:</label>
                            <input type="number" id="v3_y" value="0" step="0.1">
                        </div>
                    </div>
                </div>
                
                <div class="canvas-container">
                    <h3>2D Independence Visualization</h3>
                    <canvas id="independenceCanvas" width="400" height="300"></canvas>
                    <p style="font-size: 0.9em; text-align: center; margin-top: 10px; color: #666;">
                        Vectors are independent if they don't lie on the same line
                    </p>
                </div>
                
                <div class="controls">
                    <button class="btn" onclick="checkIndependence()">Check Independence</button>
                    <button class="btn btn-secondary" onclick="makeDependent()">Make Dependent</button>
                    <button class="btn btn-warning" onclick="randomizeVectors()">Random Vectors</button>
                    <button class="btn btn-danger" onclick="resetVectors()">Reset</button>
                </div>
                
                <div class="independence-result" id="independenceResult">
                    <h4>Click "Check Independence" to analyze vectors</h4>
                    <div class="independence-explanation">
                        Linear independence means no vector can be written as a combination of the others.
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2><span class="section-icon">🌐</span>Span Visualization</h2>
                
                <div class="span-visualization">
                    <h4>What Can These Vectors Reach?</h4>
                    <canvas id="spanCanvas" width="400" height="300"></canvas>
                    <p style="font-size: 0.9em; text-align: center; margin-top: 10px; color: #666;">
                        Span = all possible linear combinations of the vectors
                    </p>
                </div>
                
                <div class="controls">
                    <button class="btn" onclick="showSpan()">Show Span</button>
                    <button class="btn btn-secondary" onclick="animateSpan()">Animate Combinations</button>
                    <button class="btn btn-warning" onclick="clearSpan()">Clear Span</button>
                </div>
                
                <div class="concept-explanation">
                    <h4>Understanding Span</h4>
                    <p>The span of vectors is the set of all points you can reach using linear combinations:</p>
                    <div class="formula">span(v₁, v₂) = {a₁v₁ + a₂v₂ : a₁, a₂ ∈ ℝ}</div>
                    <p>• If vectors are independent: span fills 2D plane</p>
                    <p>• If vectors are dependent: span is just a line</p>
                </div>
                
                <div class="dimension-display" id="dimensionDisplay">
                    Dimension of span: ?
                </div>
            </div>
        </div>
        
        <div class="content-grid">
            <div class="section">
                <h2><span class="section-icon">🏗️</span>Basis Builder</h2>
                
                <div class="basis-builder">
                    <h4>Build a Basis for 2D Space</h4>
                    <p>A basis is a set of linearly independent vectors that span the entire space.</p>
                    
                    <div class="vector-input-grid">
                        <div class="vector-input">
                            <h4>Basis Vector 1</h4>
                            <div class="vector-components">
                                <label>x:</label>
                                <input type="number" id="b1_x" value="1" step="0.1">
                                <label>y:</label>
                                <input type="number" id="b1_y" value="0" step="0.1">
                            </div>
                        </div>
                        
                        <div class="vector-input">
                            <h4>Basis Vector 2</h4>
                            <div class="vector-components">
                                <label>x:</label>
                                <input type="number" id="b2_x" value="0" step="0.1">
                                <label>y:</label>
                                <input type="number" id="b2_y" value="1" step="0.1">
                            </div>
                        </div>
                    </div>
                    
                    <div class="controls">
                        <button class="btn btn-purple" onclick="testBasis()">Test if Basis</button>
                        <button class="btn btn-secondary" onclick="showStandardBasis()">Standard Basis</button>
                        <button class="btn btn-warning" onclick="randomBasis()">Random Basis</button>
                    </div>
                    
                    <div class="basis-test-result" id="basisResult">
                        Ready to test if these vectors form a basis...
                    </div>
                </div>
                
                <div class="concept-explanation">
                    <h4>Basis Properties</h4>
                    <p>A basis for ℝ² must satisfy:</p>
                    <p>1. <strong>Linear Independence:</strong> No vector is a combination of others</p>
                    <p>2. <strong>Spans the space:</strong> Can reach any point in ℝ²</p>
                    <p>3. <strong>Minimal:</strong> Removing any vector breaks the spanning property</p>
                    <div class="formula">For ℝ²: Need exactly 2 linearly independent vectors</div>
                </div>
                
                <div class="ml-application">
                    <h4>🤖 ML Application: Principal Components</h4>
                    <p>PCA finds an orthogonal basis where data variance is maximized!</p>
                    <p>Each principal component is a basis vector pointing in a direction of high variance.</p>
                </div>
            </div>
            
            <div class="section">
                <h2><span class="section-icon">📐</span>3D Vector Space</h2>
                
                <div class="three-container" id="threeContainer"></div>
                
                <div class="vector-input-grid">
                    <div class="vector-input">
                        <h4>3D Vector A</h4>
                        <div class="vector-components">
                            <label>x:</label>
                            <input type="number" id="v3d_a_x" value="1" step="0.1">
                            <label>y:</label>
                            <input type="number" id="v3d_a_y" value="0" step="0.1">
                            <label>z:</label>
                            <input type="number" id="v3d_a_z" value="0" step="0.1">
                        </div>
                    </div>
                    
                    <div class="vector-input">
                        <h4>3D Vector B</h4>
                        <div class="vector-components">
                            <label>x:</label>
                            <input type="number" id="v3d_b_x" value="0" step="0.1">
                            <label>y:</label>
                            <input type="number" id="v3d_b_y" value="1" step="0.1">
                            <label>z:</label>
                            <input type="number" id="v3d_b_z" value="0" step="0.1">
                        </div>
                    </div>
                    
                    <div class="vector-input">
                        <h4>3D Vector C</h4>
                        <div class="vector-components">
                            <label>x:</label>
                            <input type="number" id="v3d_c_x" value="0" step="0.1">
                            <label>y:</label>
                            <input type="number" id="v3d_c_y" value="0" step="0.1">
                            <label>z:</label>
                            <input type="number" id="v3d_c_z" value="1" step="0.1">
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-purple" onclick="update3DVectors()">Update 3D View</button>
                    <button class="btn btn-secondary" onclick="check3DIndependence()">Check 3D Independence</button>
                    <button class="btn btn-warning" onclick="randomize3D()">Randomize</button>
                </div>
                
                <div class="independence-result" id="independence3DResult">
                    <h4>3D Linear Independence Analysis</h4>
                    <div class="independence-explanation">
                        In 3D space, you need exactly 3 linearly independent vectors to span all of ℝ³.
                    </div>
                </div>
                
                <div class="concept-explanation">
                    <h4>Higher Dimensions</h4>
                    <p>The same principles apply in any dimension:</p>
                    <p>• ℝⁿ has dimension n</p>
                    <p>• A basis for ℝⁿ has exactly n vectors</p>
                    <p>• n+1 vectors in ℝⁿ are always linearly dependent</p>
                    <div class="formula">dim(ℝⁿ) = n</div>
                </div>
            </div>
        </div>
        
        <div class="section full-width">
            <h2><span class="section-icon">🎯</span>Practice Exercises</h2>
            <div class="practice-section">
                <h3>Master Vector Spaces & Independence</h3>
                
                <div class="exercise">
                    <div class="exercise-question">1. Are vectors (1,2) and (2,4) linearly independent?</div>
                    <div class="exercise-input">
                        <button class="btn" onclick="checkExercise1(true)">Yes, Independent</button>
                        <button class="btn btn-secondary" onclick="checkExercise1(false)">No, Dependent</button>
                        <span id="ex1_feedback"></span>
                    </div>
                    <p style="font-size: 0.9em; opacity: 0.8; margin-top: 10px;">
                        Hint: Is one vector a scalar multiple of the other?
                    </p>
                </div>
                
                <div class="exercise">
                    <div class="exercise-question">2. What is the dimension of the span of vectors (1,0) and (0,1)?</div>
                    <div class="exercise-input">
                        <span>Dimension = </span>
                        <input type="number" id="ex2_dim" placeholder="?" style="width: 60px; text-align: center;">
                        <button class="btn" onclick="checkExercise2()">Check</button>
                        <span id="ex2_feedback"></span>
                    </div>
                </div>
                
                <div class="exercise">
                    <div class="exercise-question">3. In ℝ³, what's the maximum number of linearly independent vectors possible?</div>
                    <div class="exercise-input">
                        <span>Maximum = </span>
                        <input type="number" id="ex3_max" placeholder="?" style="width: 60px; text-align: center;">
                        <button class="btn" onclick="checkExercise3()">Check</button>
                        <span id="ex3_feedback"></span>
                    </div>
                </div>
                
                <div class="exercise">
                    <div class="exercise-question">4. If three vectors in ℝ² are linearly dependent, what does their span look like?</div>
                    <div class="exercise-input">
                        <button class="btn" onclick="checkExercise4('point')">A single point</button>
                        <button class="btn btn-secondary" onclick="checkExercise4('line')">A line through origin</button>
                        <button class="btn btn-warning" onclick="checkExercise4('plane')">The entire plane</button>
                        <span id="ex4_feedback"></span>
                    </div>
                    <p style="font-size: 0.9em; opacity: 0.8; margin-top: 10px;">
                        Think: What's the most these dependent vectors can span?
                    </p>
                </div>
                
                <div class="exercise">
                    <div class="exercise-question">5. True or False: Every set of 4 vectors in ℝ³ is linearly dependent.</div>
                    <div class="exercise-input">
                        <button class="btn" onclick="checkExercise5(true)">True</button>
                        <button class="btn btn-secondary" onclick="checkExercise5(false)">False</button>
                        <span id="ex5_feedback"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Canvas setup
        const indCanvas = document.getElementById('independenceCanvas');
        const indCtx = indCanvas.getContext('2d');
        const spanCanvas = document.getElementById('spanCanvas');
        const spanCtx = spanCanvas.getContext('2d');
        
        // 3D Scene setup
        let scene, camera, renderer, vectors3D = [];
        
        // Current vectors
        let vectors = {
            v1: { x: 2, y: 1 },
            v2: { x: 1, y: 3 },
            v3: { x: 0, y: 0 }
        };
        
        let vectors3D_data = {
            a: { x: 1, y: 0, z: 0 },
            b: { x: 0, y: 1, z: 0 },
            c: { x: 0, y: 0, z: 1 }
        };
        
        function init3D() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, 400/400, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(400, 400);
            renderer.setClearColor(0x2a2a2a);
            document.getElementById('threeContainer').appendChild(renderer.domElement);
            
            // Add grid
            const gridHelper = new THREE.GridHelper(6, 6, 0x404040, 0x404040);
            scene.add(gridHelper);
            
            // Add axes
            const axesHelper = new THREE.AxesHelper(3);
            scene.add(axesHelper);
            
            camera.position.set(5, 4, 5);
            camera.lookAt(0, 0, 0);
            
            // Add orbit controls simulation
            let mouseDown = false;
            let mouseX = 0, mouseY = 0;
            
            renderer.domElement.addEventListener('mousedown', (e) => {
                mouseDown = true;
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            renderer.domElement.addEventListener('mouseup', () => {
                mouseDown = false;
            });
            
            renderer.domElement.addEventListener('mousemove', (e) => {
                if (!mouseDown) return;
                
                const deltaX = e.clientX - mouseX;
                const deltaY = e.clientY - mouseY;
                
                const spherical = new THREE.Spherical();
                spherical.setFromVector3(camera.position);
                spherical.theta -= deltaX * 0.01;
                spherical.phi += deltaY * 0.01;
                spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
                
                camera.position.setFromSpherical(spherical);
                camera.lookAt(0, 0, 0);
                
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            update3DVectors();
            animate3D();
        }
        
        function animate3D() {
            requestAnimationFrame(animate3D);
            renderer.render(scene, camera);
        }
        
        function drawGrid(ctx, canvas) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 30;
            
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            ctx.setLineDash([2, 2]);
            
            for (let i = -10; i <= 10; i++) {
                ctx.beginPath();
                ctx.moveTo(centerX + i * scale, 0);
                ctx.lineTo(centerX + i * scale, canvas.height);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, centerY - i * scale);
                ctx.lineTo(canvas.width, centerY - i * scale);
                ctx.stroke();
            }
            
            ctx.setLineDash([]);
        }
        
        function drawAxes(ctx, canvas) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, canvas.height);
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.fillText('x', canvas.width - 20, centerY - 10);
            ctx.fillText('y', centerX + 10, 15);
        }
        
        function drawVector(ctx, canvas, vector, color, label) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 30;
            
            const endX = centerX + vector.x * scale;
            const endY = centerY - vector.y * scale;
            
            // Draw vector line
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(endX, endY);
            ctx.stroke();
            
            // Draw arrowhead as dot
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(endX, endY, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            // Draw label
            ctx.fillStyle = color;
            ctx.font = 'bold 14px Arial';
            ctx.fillText(label, endX + 8, endY - 8);
        }
        
        function drawIndependenceVisualization() {
            indCtx.clearRect(0, 0, indCanvas.width, indCanvas.height);
            drawGrid(indCtx, indCanvas);
            drawAxes(indCtx, indCanvas);
            
            // Get current vector values
            updateVectorValues();
            
            // Draw vectors
            if (vectors.v1.x !== 0 || vectors.v1.y !== 0) {
                drawVector(indCtx, indCanvas, vectors.v1, '#ff6b6b', 'v₁');
            }
            if (vectors.v2.x !== 0 || vectors.v2.y !== 0) {
                drawVector(indCtx, indCanvas, vectors.v2, '#4ecdc4', 'v₂');
            }
            if (vectors.v3.x !== 0 || vectors.v3.y !== 0) {
                drawVector(indCtx, indCanvas, vectors.v3, '#45b7d1', 'v₃');
            }
        }
        
        function updateVectorValues() {
            vectors.v1.x = parseFloat(document.getElementById('v1_x').value) || 0;
            vectors.v1.y = parseFloat(document.getElementById('v1_y').value) || 0;
            vectors.v2.x = parseFloat(document.getElementById('v2_x').value) || 0;
            vectors.v2.y = parseFloat(document.getElementById('v2_y').value) || 0;
            vectors.v3.x = parseFloat(document.getElementById('v3_x').value) || 0;
            vectors.v3.y = parseFloat(document.getElementById('v3_y').value) || 0;
        }
        
        function checkIndependence() {
            updateVectorValues();
            
            // Count non-zero vectors
            const nonZeroVectors = [];
            if (vectors.v1.x !== 0 || vectors.v1.y !== 0) nonZeroVectors.push(vectors.v1);
            if (vectors.v2.x !== 0 || vectors.v2.y !== 0) nonZeroVectors.push(vectors.v2);
            if (vectors.v3.x !== 0 || vectors.v3.y !== 0) nonZeroVectors.push(vectors.v3);
            
            const result = document.getElementById('independenceResult');
            
            if (nonZeroVectors.length === 0) {
                result.className = 'independence-result dependent';
                result.innerHTML = `
                    <h4>All Zero Vectors</h4>
                    <div class="independence-explanation">
                        Zero vectors are always linearly dependent.
                    </div>
                `;
                return;
            }
            
            if (nonZeroVectors.length === 1) {
                result.className = 'independence-result independent';
                result.innerHTML = `
                    <h4>Linearly Independent</h4>
                    <div class="independence-explanation">
                        A single non-zero vector is always linearly independent.
                    </div>
                `;
                updateDimensionDisplay(1);
                return;
            }
            
            if (nonZeroVectors.length === 2) {
                // Check if one is a scalar multiple of the other
                const v1 = nonZeroVectors[0];
                const v2 = nonZeroVectors[1];
                
                // Calculate cross product (determinant) for 2D
                const det = v1.x * v2.y - v1.y * v2.x;
                const isIndependent = Math.abs(det) > 0.001;
                
                result.className = `independence-result ${isIndependent ? 'independent' : 'dependent'}`;
                result.innerHTML = `
                    <h4>Linearly ${isIndependent ? 'Independent' : 'Dependent'}</h4>
                    <div class="independence-explanation">
                        ${isIndependent ? 
                            'Vectors point in different directions - they span the entire 2D plane!' :
                            'One vector is a scalar multiple of the other - they lie on the same line.'}
                        <br><strong>Determinant:</strong> ${det.toFixed(3)}
                    </div>
                `;
                updateDimensionDisplay(isIndependent ? 2 : 1);
                return;
            }
            
            if (nonZeroVectors.length === 3) {
                // In 2D, any 3 vectors are automatically dependent
                result.className = 'independence-result dependent';
                result.innerHTML = `
                    <h4>Linearly Dependent</h4>
                    <div class="independence-explanation">
                        In 2D space, any 3 or more vectors are automatically linearly dependent!
                        Maximum independent vectors in ℝ² is 2.
                    </div>
                `;
                updateDimensionDisplay(2);
            }
        }
        
        function updateDimensionDisplay(dim) {
            document.getElementById('dimensionDisplay').textContent = `Dimension of span: ${dim}`;
        }
        
        function makeDependent() {
            // Make v2 a scalar multiple of v1
            const v1x = parseFloat(document.getElementById('v1_x').value) || 1;
            const v1y = parseFloat(document.getElementById('v1_y').value) || 1;
            
            document.getElementById('v2_x').value = (v1x * 2).toFixed(1);
            document.getElementById('v2_y').value = (v1y * 2).toFixed(1);
            document.getElementById('v3_x').value = 0;
            document.getElementById('v3_y').value = 0;
            
            drawIndependenceVisualization();
            checkIndependence();
        }
        
        function randomizeVectors() {
            document.getElementById('v1_x').value = (Math.random() * 6 - 3).toFixed(1);
            document.getElementById('v1_y').value = (Math.random() * 6 - 3).toFixed(1);
            document.getElementById('v2_x').value = (Math.random() * 6 - 3).toFixed(1);
            document.getElementById('v2_y').value = (Math.random() * 6 - 3).toFixed(1);
            document.getElementById('v3_x').value = (Math.random() * 2 - 1).toFixed(1);
            document.getElementById('v3_y').value = (Math.random() * 2 - 1).toFixed(1);
            
            drawIndependenceVisualization();
        }
        
        function resetVectors() {
            document.getElementById('v1_x').value = 2;
            document.getElementById('v1_y').value = 1;
            document.getElementById('v2_x').value = 1;
            document.getElementById('v2_y').value = 3;
            document.getElementById('v3_x').value = 0;
            document.getElementById('v3_y').value = 0;
            
            drawIndependenceVisualization();
            checkIndependence();
        }
        
        function showSpan() {
            spanCtx.clearRect(0, 0, spanCanvas.width, spanCanvas.height);
            drawGrid(spanCtx, spanCanvas);
            drawAxes(spanCtx, spanCanvas);
            
            updateVectorValues();
            
            const centerX = spanCanvas.width / 2;
            const centerY = spanCanvas.height / 2;
            const scale = 30;
            
            // Get active vectors
            const activeVectors = [];
            if (vectors.v1.x !== 0 || vectors.v1.y !== 0) activeVectors.push(vectors.v1);
            if (vectors.v2.x !== 0 || vectors.v2.y !== 0) activeVectors.push(vectors.v2);
            
            if (activeVectors.length === 0) return;
            
            if (activeVectors.length === 1) {
                // Span is a line through origin
                const v = activeVectors[0];
                const length = Math.sqrt(v.x * v.x + v.y * v.y);
                const unitX = v.x / length;
                const unitY = v.y / length;
                
                spanCtx.strokeStyle = 'rgba(255, 193, 7, 0.8)';
                spanCtx.lineWidth = 4;
                spanCtx.beginPath();
                spanCtx.moveTo(centerX - unitX * 200, centerY + unitY * 200);
                spanCtx.lineTo(centerX + unitX * 200, centerY - unitY * 200);
                spanCtx.stroke();
                
            } else if (activeVectors.length === 2) {
                // Check if independent
                const det = activeVectors[0].x * activeVectors[1].y - activeVectors[0].y * activeVectors[1].x;
                
                if (Math.abs(det) > 0.001) {
                    // Independent - spans entire plane
                    spanCtx.fillStyle = 'rgba(255, 193, 7, 0.3)';
                    spanCtx.fillRect(0, 0, spanCanvas.width, spanCanvas.height);
                    
                    spanCtx.fillStyle = '#333';
                    spanCtx.font = '16px Arial';
                    spanCtx.textAlign = 'center';
                    spanCtx.fillText('Spans entire 2D plane', centerX, 30);
                } else {
                    // Dependent - same line
                    const v = activeVectors[0];
                    const length = Math.sqrt(v.x * v.x + v.y * v.y);
                    const unitX = v.x / length;
                    const unitY = v.y / length;
                    
                    spanCtx.strokeStyle = 'rgba(255, 193, 7, 0.8)';
                    spanCtx.lineWidth = 4;
                    spanCtx.beginPath();
                    spanCtx.moveTo(centerX - unitX * 200, centerY + unitY * 200);
                    spanCtx.lineTo(centerX + unitX * 200, centerY - unitY * 200);
                    spanCtx.stroke();
                }
            }
            
            // Draw original vectors
            drawVector(spanCtx, spanCanvas, vectors.v1, '#ff6b6b', 'v₁');
            drawVector(spanCtx, spanCanvas, vectors.v2, '#4ecdc4', 'v₂');
        }
        
        function animateSpan() {
            showSpan();
            
            // Animate some linear combinations
            updateVectorValues();
            const activeVectors = [];
            if (vectors.v1.x !== 0 || vectors.v1.y !== 0) activeVectors.push(vectors.v1);
            if (vectors.v2.x !== 0 || vectors.v2.y !== 0) activeVectors.push(vectors.v2);
            
            if (activeVectors.length < 2) return;
            
            let step = 0;
            const maxSteps = 20;
            
            function animateStep() {
                if (step >= maxSteps) return;
                
                const t1 = Math.sin(step * 0.3) * 2;
                const t2 = Math.cos(step * 0.4) * 1.5;
                
                const combo = {
                    x: t1 * activeVectors[0].x + t2 * activeVectors[1].x,
                    y: t1 * activeVectors[0].y + t2 * activeVectors[1].y
                };
                
                drawVector(spanCtx, spanCanvas, combo, '#9C27B0', `${t1.toFixed(1)}v₁+${t2.toFixed(1)}v₂`);
                
                step++;
                setTimeout(animateStep, 300);
            }
            
            setTimeout(animateStep, 500);
        }
        
        function clearSpan() {
            spanCtx.clearRect(0, 0, spanCanvas.width, spanCanvas.height);
            drawGrid(spanCtx, spanCanvas);
            drawAxes(spanCtx, spanCanvas);
            
            drawVector(spanCtx, spanCanvas, vectors.v1, '#ff6b6b', 'v₁');
            drawVector(spanCtx, spanCanvas, vectors.v2, '#4ecdc4', 'v₂');
        }
        
        function testBasis() {
            const b1x = parseFloat(document.getElementById('b1_x').value) || 0;
            const b1y = parseFloat(document.getElementById('b1_y').value) || 0;
            const b2x = parseFloat(document.getElementById('b2_x').value) || 0;
            const b2y = parseFloat(document.getElementById('b2_y').value) || 0;
            
            const det = b1x * b2y - b1y * b2x;
            const isValidBasis = Math.abs(det) > 0.001;
            
            const result = document.getElementById('basisResult');
            result.className = `basis-test-result ${isValidBasis ? 'valid-basis' : 'invalid-basis'}`;
            result.innerHTML = isValidBasis ? 
                `✓ Valid Basis for ℝ²<br>Determinant: ${det.toFixed(3)} ≠ 0<br>These vectors span all of 2D space!` :
                `✗ Not a Basis<br>Determinant: ${det.toFixed(3)} ≈ 0<br>Vectors are linearly dependent`;
        }
        
        function showStandardBasis() {
            document.getElementById('b1_x').value = 1;
            document.getElementById('b1_y').value = 0;
            document.getElementById('b2_x').value = 0;
            document.getElementById('b2_y').value = 1;
            testBasis();
        }
        
        function randomBasis() {
            // Generate random but valid basis
            const angle1 = Math.random() * 2 * Math.PI;
            const angle2 = angle1 + Math.PI/4 + Math.random() * Math.PI/2;
            
            document.getElementById('b1_x').value = Math.cos(angle1).toFixed(2);
            document.getElementById('b1_y').value = Math.sin(angle1).toFixed(2);
            document.getElementById('b2_x').value = Math.cos(angle2).toFixed(2);
            document.getElementById('b2_y').value = Math.sin(angle2).toFixed(2);
            testBasis();
        }
        
        function update3DVectors() {
            // Clear existing vectors
            vectors3D.forEach(vector => scene.remove(vector));
            vectors3D = [];
            
            // Get vector values
            vectors3D_data.a.x = parseFloat(document.getElementById('v3d_a_x').value) || 0;
            vectors3D_data.a.y = parseFloat(document.getElementById('v3d_a_y').value) || 0;
            vectors3D_data.a.z = parseFloat(document.getElementById('v3d_a_z').value) || 0;
            
            vectors3D_data.b.x = parseFloat(document.getElementById('v3d_b_x').value) || 0;
            vectors3D_data.b.y = parseFloat(document.getElementById('v3d_b_y').value) || 0;
            vectors3D_data.b.z = parseFloat(document.getElementById('v3d_b_z').value) || 0;
            
            vectors3D_data.c.x = parseFloat(document.getElementById('v3d_c_x').value) || 0;
            vectors3D_data.c.y = parseFloat(document.getElementById('v3d_c_y').value) || 0;
            vectors3D_data.c.z = parseFloat(document.getElementById('v3d_c_z').value) || 0;
            
            // Create vector arrows
            const colors = [0xff6b6b, 0x4ecdc4, 0x45b7d1];
            const vectorData = [vectors3D_data.a, vectors3D_data.b, vectors3D_data.c];
            
            vectorData.forEach((vec, i) => {
                if (vec.x !== 0 || vec.y !== 0 || vec.z !== 0) {
                    const direction = new THREE.Vector3(vec.x, vec.y, vec.z);
                    const origin = new THREE.Vector3(0, 0, 0);
                    const length = direction.length();
                    
                    if (length > 0) {
                        const arrowHelper = new THREE.ArrowHelper(
                            direction.normalize(), 
                            origin, 
                            length, 
                            colors[i], 
                            length * 0.2, 
                            length * 0.1
                        );
                        scene.add(arrowHelper);
                        vectors3D.push(arrowHelper);
                    }
                }
            });
        }
        
        function check3DIndependence() {
            // For 3D independence, we need to check if the determinant of the 3x3 matrix is non-zero
            const a = vectors3D_data.a;
            const b = vectors3D_data.b;
            const c = vectors3D_data.c;
            
            // Calculate 3x3 determinant
            const det = a.x * (b.y * c.z - b.z * c.y) - 
                        a.y * (b.x * c.z - b.z * c.x) + 
                        a.z * (b.x * c.y - b.y * c.x);
            
            const isIndependent = Math.abs(det) > 0.001;
            
            const result = document.getElementById('independence3DResult');
            result.className = `independence-result ${isIndependent ? 'independent' : 'dependent'}`;
            result.innerHTML = `
                <h4>3D Vectors are ${isIndependent ? 'Independent' : 'Dependent'}</h4>
                <div class="independence-explanation">
                    ${isIndependent ? 
                        'These vectors span all of 3D space (ℝ³)!' :
                        'These vectors are coplanar or collinear - they don\'t span all of ℝ³.'}
                    <br><strong>Determinant:</strong> ${det.toFixed(3)}
                    <br><strong>Dimension of span:</strong> ${isIndependent ? 3 : (det === 0 ? '< 3' : '?')}
                </div>
            `;
        }
        
        function randomize3D() {
            document.getElementById('v3d_a_x').value = (Math.random() * 4 - 2).toFixed(1);
            document.getElementById('v3d_a_y').value = (Math.random() * 4 - 2).toFixed(1);
            document.getElementById('v3d_a_z').value = (Math.random() * 4 - 2).toFixed(1);
            
            document.getElementById('v3d_b_x').value = (Math.random() * 4 - 2).toFixed(1);
            document.getElementById('v3d_b_y').value = (Math.random() * 4 - 2).toFixed(1);
            document.getElementById('v3d_b_z').value = (Math.random() * 4 - 2).toFixed(1);
            
            document.getElementById('v3d_c_x').value = (Math.random() * 4 - 2).toFixed(1);
            document.getElementById('v3d_c_y').value = (Math.random() * 4 - 2).toFixed(1);
            document.getElementById('v3d_c_z').value = (Math.random() * 4 - 2).toFixed(1);
            
            update3DVectors();
        }
        
        // Exercise checking functions
        function checkExercise1(userAnswer) {
            const correct = false; // (2,4) = 2*(1,2), so they're dependent
            
            if (userAnswer === correct) {
                document.getElementById('ex1_feedback').innerHTML = ' <span style="color: #4CAF50;">✓ Correct! (2,4) = 2×(1,2)</span>';
            } else {
                document.getElementById('ex1_feedback').innerHTML = ' <span style="color: #f44336;">✗ Wrong. One is a scalar multiple of the other.</span>';
            }
        }
        
        function checkExercise2() {
            const userAnswer = parseInt(document.getElementById('ex2_dim').value);
            const correct = 2; // Standard basis vectors span ℝ²
            
            if (userAnswer === correct) {
                document.getElementById('ex2_feedback').innerHTML = ' <span style="color: #4CAF50;">✓ Correct! These are the standard basis vectors.</span>';
            } else {
                document.getElementById('ex2_feedback').innerHTML = ' <span style="color: #f44336;">✗ Wrong. Independent vectors span the full space.</span>';
            }
        }
        
        function checkExercise3() {
            const userAnswer = parseInt(document.getElementById('ex3_max').value);
            const correct = 3; // Dimension of ℝ³ is 3
            
            if (userAnswer === correct) {
                document.getElementById('ex3_feedback').innerHTML = ' <span style="color: #4CAF50;">✓ Correct! dim(ℝ³) = 3</span>';
            } else {
                document.getElementById('ex3_feedback').innerHTML = ' <span style="color: #f44336;">✗ Wrong. Maximum = dimension of the space.</span>';
            }
        }
        
        function checkExercise4(userAnswer) {
            const correct = 'line'; // Dependent vectors in ℝ² can span at most a line
            
            if (userAnswer === correct) {
                document.getElementById('ex4_feedback').innerHTML = ' <span style="color: #4CAF50;">✓ Correct! Dependent vectors can\'t span the full plane.</span>';
            } else {
                document.getElementById('ex4_feedback').innerHTML = ' <span style="color: #f44336;">✗ Wrong. Dependent vectors span less than the full space.</span>';
            }
        }
        
        function checkExercise5(userAnswer) {
            const correct = true; // Any 4 vectors in ℝ³ must be dependent
            
            if (userAnswer === correct) {
                document.getElementById('ex5_feedback').innerHTML = ' <span style="color: #4CAF50;">✓ Correct! Cannot have more than 3 independent vectors in ℝ³.</span>';
            } else {
                document.getElementById('ex5_feedback').innerHTML = ' <span style="color: #f44336;">✗ Wrong. Dimension limits the number of independent vectors.</span>';
            }
        }
        
        // Event listeners for real-time updates
        document.addEventListener('DOMContentLoaded', function() {
            // Add input listeners for real-time visualization updates
            ['v1_x', 'v1_y', 'v2_x', 'v2_y', 'v3_x', 'v3_y'].forEach(id => {
                document.getElementById(id).addEventListener('input', drawIndependenceVisualization);
            });
            
            ['b1_x', 'b1_y', 'b2_x', 'b2_y'].forEach(id => {
                document.getElementById(id).addEventListener('input', testBasis);
            });
            
            ['v3d_a_x', 'v3d_a_y', 'v3d_a_z', 'v3d_b_x', 'v3d_b_y', 'v3d_b_z', 'v3d_c_x', 'v3d_c_y', 'v3d_c_z'].forEach(id => {
                document.getElementById(id).addEventListener('input', update3DVectors);
            });
        });
        
        // Initialize everything
        window.addEventListener('load', function() {
            drawIndependenceVisualization();
            checkIndependence();
            testBasis();
            init3D();
        });
    </script>
</body>
</html>
